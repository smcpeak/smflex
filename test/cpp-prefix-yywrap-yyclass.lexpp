/* cpp-prefix-yywrap-yyclass.lexpp */
/* C++ scanner using %option prefix, %option yywrap, and
 * %option yyclass. */

%option c++
%option main
%option prefix="MyLexer"
%option yywrap
%option yyclass="MyClass"

%{
#include <fstream>           // ifstream
#include <iostream>          // cout

using std::cout;
using std::ifstream;
using std::istream;

class MyClass : public MyLexerFlexLexer {
public:
  int yym_lex();
  int yym_wrap();
};
%}

%%
username           cout << "USERNAME";

%%

/* Non-NULL once we have read the second input. */
static istream *secondFile = NULL;

int MyClass::yym_wrap()
{
  if (!secondFile) {
    secondFile = new ifstream("cppscan-yywrap.input2");
    if (secondFile->fail()) {
      perror("new ifstream(cppscan-yywrap.input2)");
      delete secondFile;
      exit(2);
    }

    yym_switch_streams(secondFile);

    /* Not done, keep going. */
    return 0;
  }
  else {
    delete secondFile;

    /* All done. */
    return 1;
  }
}


/* EOF */
